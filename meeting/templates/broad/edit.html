<html lang="en">

<head>
    {% include 'includes/head.html' %}
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css">

    <!-- 구글폰트 -->
    <link href="https://fonts.googleapis.com/css?family=Stylish&display=swap" rel="stylesheet">

    <title>Document</title>

    <!-- style -->
    <style type="text/css">
        .wrap {
            margin: 120px auto;
        }

        .top-of-page h2,
        .top-of-page a {
            display: inline;
        }

        .login {
            float: right;
        }

        .top-of-page a {
            text-decoration-line: none;
        }

        #image_container>img {
            width: 150px;
            height: 150px;
        }
    </style>
</head>

<body>
    {% include 'includes/header.html' %}
    <div class="wrap">
        <div>모임 이름</div>
        <input id="studyName" type="text" placeholder="15자 이내" value="{{article.title}}">
        <div>모임 사진</div>
        <input id="image" type="file" accept="image/*" onchange="setThumbnail(event);">
        <div id="image_container"></div>
        <div>모임 소개</div>
        <input id="studyIntro" type="text" placeholder="50자 이내" value="{{article.intro}}">
        <div>인원</div>
        <input id="headCount" type="text" placeholder="00명" value="{{article.people}}">
        <div>진행 기간</div>
        <input id="startDate" type="date" placeholder="시작일" value="{{article.sdate}}">
        <input id="endDate" type="date" placeholder="종료일" value="{{article.edate}}">
        <div>위치</div>
        <input id="firstPlace" type="text" placeholder="주소 입력" value="{{article.fpalce}}">
        <input id="secondPlace" type="text" placeholder="상세주소 입력" value="{{article.splace}}">
        <div>상세설명</div>
        <textarea id="studyDesc" cols="30" rows="10" placeholder="내용을 입력해주세요">{{article.desc}}</textarea>
        <div>
            <input class="btn btn-success" type="submit" value="수정" onclick="updateArticle('{{article._id}}')">
            <button class="btn btn-danger" onclick="goMain()">취소</button>
        </div>
    </div>
    {% include 'includes/plugin.html'%}
    <script>
        function setThumbnail(event) {
            var reader = new FileReader();

            reader.onload = function (event) {
                var img = document.createElement("img");
                img.setAttribute("src", event.target.result);
                document.querySelector("div#image_container").appendChild(img);
            };
            reader.readAsDataURL(event.target.files[0]);
        }

        function updateArticle(_id) {
            let userId = $.cookie('myToken');
            let title = $("#studyName").val();
            let intro = $("#studyIntro").val();
            let people = $("#headCount").val();
            let sdate = $("#startDate").val();
            let edate = $("#endDate").val();
            let fplace = $("#firstPlace").val();
            let splace = $("#secondPlace").val();
            let desc = $("#studyDesc").val();

            // 2. memo에 POST 방식으로 메모 생성 요청하기
            $.ajax({
                type: "POST", // POST 방식으로 요청하겠다.
                url: "/api/update", // /memo라는 url에 요청하겠다.
                data: {
                    postId_give: _id,
                    uId_give: userId,
                    title_give: title,
                    intro_give: intro,
                    people_give: people,
                    sdate_give: sdate,
                    edate_give: edate,
                    fplace_give: fplace,
                    splace_give: splace,
                    desc_give: desc
                }, // 데이터를 주는 방법
                success: function (response) { // 성공하면
                    if (response["result"] == "success") {
                        alert("수정 완료!");
                        // 3. 성공 시 페이지 새로고침하기
                        goMain()
                    } else {
                        alert("서버 오류!")
                    }
                }
            })
        }
    </script>
</body>

</html>